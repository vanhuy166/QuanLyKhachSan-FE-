<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Document</title>

    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700|Work+Sans:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="./fonts/icomoon/style.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/magnific-popup.css">
    <link rel="stylesheet" href="./css/jquery-ui.css">
    <link rel="stylesheet" href="./css/owl.carousel.min.css">
    <link rel="stylesheet" href="./css/owl.theme.default.min.css">
    <link rel="stylesheet" href="./css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="./css/animate.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mediaelement@4.2.7/build/mediaelementplayer.min.css">
    <link rel="stylesheet" href="./fonts/flaticon/font/flaticon.css">
    <link rel="stylesheet" href="./css/aos.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/login.css">
</head>


<body>
    <div class="content-wrapper">
        <div class="content">
            <div class="signup-wrapper shadow-box">
                <div class="company-details ">

                    <div class="shadow"></div>
                    <div class="wrapper-1">
                        <div class="logo">
                            <div class="icon-food">

                            </div>
                        </div>
                        <h1 class="title">ROOM co.</h1>
                        <div class="slogan">We are number 2, no one is number 1.</div>
                    </div>

                </div>
                <div class="signup-form ">
                    <div class="wrapper-2">
                        <div class="form-title">Login !</div>
                        <div class="form">
                            <form>


                                <p class="content-item">
                                    <label>username</label>
                                    <input style="border-bottom:1px solid rgba(0,0,0,0.5);" id="username" type="text" name="email">
                                </p>

                                <p class="content-item">

                                    <label>password</label>
                                    <input style="border-bottom:1px solid rgba(0,0,0,0.5);" id="password" type="password" name="psw">
                                </p>
                            </form>
                            <button id="login" class="signup">login </button>
                            <a href="./DangKy.html" class="login">sign up</a>
                        </div>
                    </div>

                </div>


            </div>
        </div>
    </div>



    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/mediaelement-and-player.min.js"></script>
    <script src="js/main.js"></script>

    <script>
        $(document).ready(function() {
            $("#login").click(function() {

                var data = {
                    "username": $("#username").val(),
                    "password": $("#password").val(),
                };

                $.ajax({
                    url: 'http://localhost:8083/api/v1/users/login',
                    type: 'POST',
                    data: JSON.stringify(data),
                    error: function(err) {
                        console.log('Error!', err)
                        alert("Đăng nhập thất bại!");
                    },
                    success: function(data) {
                        var token = data.token;
                        localStorage.setItem("token", token);

                        var role = parseJwt(token);
                        if (role.authorities[0].authority == "ROLE_ADMIN") {
                            window.location = "./FrontendAdmin/DanhSachPhong.html";
                        } else {
                            window.location = "./index.html";
                        }
                    }
                });
            });
        });

        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        };
    </script>

</body>

</html>